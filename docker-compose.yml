services:
  api:
    build: .
    ports:
      - "8000:8000"
    environment:
      AWS_REGION: ${AWS_REGION:-us-east-1}
      AWS_ENDPOINT: ${AWS_ENDPOINT:-http://localstack:4566}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID:-test}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY:-test}
      SQS_QUEUE_NAME: ${SQS_QUEUE_NAME:-ai-jobs}
    depends_on:
      - localstack
  worker:
    build: .
    command: ["python", "-m", "worker.main"]
    environment:
      AWS_REGION: ${AWS_REGION:-us-east-1}
      AWS_ENDPOINT: ${AWS_ENDPOINT:-http://localstack:4566}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID:-test}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY:-test}
      SQS_QUEUE_NAME: ${SQS_QUEUE_NAME:-ai-jobs}
    depends_on:
      - localstack
  localstack:
    image: localstack/localstack:3.7
    environment:
      SERVICES: sqs
      DEBUG: "0"
    ports:
      - "4566:4566"
    volumes:
      - "localstack_data:/var/lib/localstack"

volumes:
  localstack_data: